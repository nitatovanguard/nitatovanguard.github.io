function t(t,s,h,e){return Math.pow(t-h,2)+Math.pow(s-e,2)}function s(t,s){return new e(t.x*s.x-t.y*s.y,t.y*s.x+t.x*s.y)}function h(t,s,h){return-s*h.x+t*h.y}class e{constructor(t,s){this.x=t,this.y=s}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}normalize(){let t=this.length();this.x/=t,this.y/=t}}const i=Math.PI/2,o=new e(Math.cos(i/2),Math.sin(i/2)),n=new e(Math.cos(-i/2),Math.sin(-i/2));class r{constructor(t,s,h,e,i){this.x=t,this.y=s,this.tx=h,this.ty=e,this.carrying=!1,this.tfood=!1,this.s=i,this.drop=!0,this.tage=50001}}class a{constructor(t,s){this.x=t,this.y=s,this.target=!1}}class y{constructor(t,s){this.x=t,this.y=s,this.strength=5e4}}class x{constructor(t,s,h){this.x=t,this.y=s,this.antn=h,this.foodn=0}}export class World{constructor(t,s){this.ants=[],this.foods=[],this.pheromones=[],this.base=null,this.width=t,this.height=s,this.showLines=!0}addAnt(t){for(let s=t;s>0;--s){let t=new r(this.base.x,this.base.y,Math.random()*this.width,Math.random()*this.height,2);this.ants.push(t)}}initBase(t,s,h){this.base=new x(t,s,h),this.addAnt(h)}addFood(t,s){let h=new a(t,s);this.foods.push(h)}resetTargets(){this.ants.forEach(t=>{t.tx=Math.random()*this.width,t.ty=Math.random()*this.height})}setSize(t,s){this.width=t,this.height=s}toggleDestinations(){this.showLines=!this.showLines}update(i){this.ants.forEach(i=>{let r=new e(i.tx-i.x,i.ty-i.y);r.normalize(),i.x+=r.x*i.s,i.y+=r.y*i.s,t(i.x,i.y,this.base.x,this.base.y)<625&&i.carrying&&(i.carrying=!1,++this.base.foodn,console.log(this.base.foodn)),this.foods.forEach(e=>{t(i.x,i.y,e.x,e.y)<5e3&&!i.carrying&&!i.tfood&&!e.target&&h(e.x-i.x,e.y-i.y,s(o,r))>=0&&h(e.x-i.x,e.y-i.y,s(n,r))<=0&&(i.tx=e.x,i.ty=e.y,i.tfood=!0,e.target=!0),t(i.x,i.y,e.x,e.y)<100&&!i.carrying&&(i.carrying=!0,this.foods.splice(this.foods.indexOf(e),1))}),t(i.x,i.y,i.tx,i.ty)<100&&(i.tx=Math.random()*this.width,i.ty=Math.random()*this.height),i.carrying?(i.tx=this.base.x,i.ty=this.base.y,this.pheromones.forEach(s=>{t(s.x,s.y,i.x,i.y)<=25&&(s.strength=5e4,i.drop=!1),s.strength-=1,s.strength<=0&&this.pheromones.splice(this.pheromones.indexOf(s),1)}),i.drop&&this.pheromones.push(new y(i.x,i.y)),i.drop=!0,i.tfood=!1,i.tage=50001):i.tfood||this.pheromones.forEach(s=>{s.strength-=1,s.strength<=0&&this.pheromones.splice(this.pheromones.indexOf(s),1),t(s.x,s.y,i.x,i.y)<=5e3&&i.tage>s.strength&&(i.tx=s.x,i.ty=s.y,i.tage=s.strength)})})}draw(t){t.clear(),t.setPen("brown",1,1),t.fillCircle(this.base.x,this.base.y,30),this.pheromones.forEach(s=>{t.setPen("lime",1,s.strength/1e3),t.drawDot(s.x,s.y,5)}),this.ants.forEach(s=>{this.showLines&&(t.setPen("orange",1,1),t.drawLineStrip([s.x,s.y,s.tx,s.ty])),t.setPen("red",1,1),t.drawCircle(s.x,s.y,10),t.setPen("black",1,1),s.carrying&&t.setPen("chocolate"),t.drawDot(s.x,s.y,5)}),this.foods.forEach(s=>{t.setPen("chocolate",1,1),t.drawDot(s.x,s.y,5)})}}