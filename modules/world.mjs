import{Ant as t}from"./antclass.mjs";import{Base as s}from"./baseclass.mjs";import{Food as e}from"./foodclass.mjs";import{Pheromones as o}from"./pheromones.mjs";import{SpatialDB as i}from"./spatialdbclass.mjs";Math.PI;export class World{constructor(s,e){this.protoAnt=new t(0,0,null),this.ants=new i,this.foods=new i,this.base=null,this.setSize(s,e),this.foodph=new o,this.nestph=new o,this.showDestinations=!0,this.foodPheromoneDecayRate=.997,this.nestPheromoneDecayRate=.997,this.tick=0,this.ticksPerFrame=0,this.ticksAcc=0,this.maxFoodPheromoneStrength=0,this.maxNestPheromoneStrength=0}removeFood(t){this.foods.removeItem(t)}initBase(t,e,o){this.base=new s(t,e,o),this.setNumAnts(o)}reset(){const t=this.ants.size();this.setNumAnts(0),this.deletePheromones(),this.setNumAnts(t),this.maxFoodPheromoneStrength=0,this.maxNestPheromoneStrength=0}refreshAntParams(){this.ants.items.forEach(t=>{t.copyParams(this.protoAnt)})}setNumAnts(t){for(;this.ants.size()>t;)this.ants.removeByIndex(Math.floor(Math.random()*this.ants.length));for(;this.ants.size()<t;){const t=this.protoAnt.clone(this.base.pos.x,this.base.pos.y,this.base);this.ants.add(t)}}deletePheromones(){this.foodph.clear(),this.nestph.clear()}deleteFood(){this.foods.removeAllMatching(t=>!0)}addFood(t,s){const o=new e(t,s);this.foods.add(o)}resetTargets(){this.ants.items.forEach(t=>{t.tx=Math.random()*this.width,t.ty=Math.random()*this.height})}setSize(t,s){this.width=t,this.height=s}doTick(){this.tick+=1,this.timeTotal+=this.msPerTick,this.nestph.update(),this.foodph.update(),this.ants.items.forEach(t=>{t.update(this)})}update(t){if(this.ticksPerFrame>0)for(this.ticksAcc+=this.ticksPerFrame;this.ticksAcc>1;)this.ticksAcc-=1,this.doTick();else for(;10*this.tick<t;)this.doTick()}imgdata=null;draw(t,s){s.clear();const e=s.getContext();s.setPen("brown",1,1),s.fillCircle(this.base.pos,30),e.globalCompositeOperation="lighter",this.foodph.forEach(t=>{s.setPen("limegreen",1,.1),s.fillCircle(t.pos,Math.max(.2,Math.min(20,100*t.strength)))}),this.nestph.forEach(t=>{s.setPen("cadetblue",1,.1),s.fillCircle(t.pos,Math.max(.5,Math.min(20,10*t.strength)))}),this.foods.items.forEach(t=>{s.setPen("chocolate",1,1),s.drawDot(t.pos,5)}),e.globalCompositeOperation="source-over",this.ants.items.forEach(t=>{if(this.showDestinations){s.setPen("orange",1,1),s.drawLineStrip([t.pos,t.target]);const e=t.pos.add(t.leftAntenna),o=t.pos.add(t.rightAntenna);s.drawLineStrip([t.pos,e]),s.drawLineStrip([t.pos,o]),s.drawCircle(e,t.antennaSenseRadius),s.drawCircle(o,t.antennaSenseRadius)}s.setPen(t.carrying?"red":"blue",1,1),s.drawCircle(t.pos,10),s.setPen("black",1,1),s.drawDot(t.pos,5)})}}export default{World};