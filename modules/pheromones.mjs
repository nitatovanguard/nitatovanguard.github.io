import{V2 as s}from"./v2.mjs";import{Pheromone as t}from"./pheromoneclass.mjs";import{SpatialDB as e}from"./spatialdbclass.mjs";export class Pheromones{constructor(){this.sdb=new e,this.vanishLevel=.001,this.dropGrid=7,this.decayRate=.997}add(s,e){let r=this.sdb.findNearestInRadius(s,this.dropGrid);r?r.strength+=e:this.sdb.add(new t(s.copy(),e))}detect(s,t){return this.sdb.findAllInRadius(s,t).reduce((t,e)=>t+e.strength/(e.pos.sub(s).sqLength()+1),0)}update(){this.sdb.forEach(s=>s.strength*=this.decayRate),this.sdb.removeAllMatching(s=>s.strength<this.vanishLevel)}clear(){this.sdb.removeAllMatching(()=>!0)}forEach(s){this.sdb.forEach(s)}}